<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Space Rocket Game</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <style>
    :root { --bg:#000; --txt:#fff; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--txt);
      font-family: system-ui, -apple-system, Arial, sans-serif;
      overflow: hidden;
      touch-action: none;
    }
    #gameCanvas {
      display: block;
      width: 100vw;
      height: 100vh;
      background: #000;
    }
    #homeScreen {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      gap: 1rem;
      z-index: 10;
    }
    #homeScreen h1 { font-size: clamp(24px, 5vw, 40px); margin: 0; }
    #homeScreen p  { font-size: clamp(16px, 3.5vw, 20px); margin: 0.25rem 0 0.5rem; opacity: 0.9; }
    #lastScore     { font-weight: 700; }
    #startBtn {
      padding: 12px 20px;
      font-size: clamp(16px, 4vw, 20px);
      background: #ffcc00;
      border: 0;
      border-radius: 12px;
      color: #000;
      cursor: pointer;
    }
    #startBtn:disabled { opacity: 0.6; cursor: default; }
    #startBtn:not(:disabled):hover { background:#ffdd33; }
  </style>
</head>
<body>
  <div id="homeScreen">
    <h1>üöÄ Space Rocket</h1>
    <p>–ü—É—É–∂–∏–Ω–≥–∞–∞ –∑“Ø“Ø–Ω/–±–∞—Ä—É—É–Ω **swipe**‚Äì–∞–∞—Ä —É–¥–∏—Ä–¥–∞–∂, —Å–∞–∞–¥–∞–∞—Å –±—É–ª—Ç–∞–∞–¥ coin —Ü—É–≥–ª—É—É–ª!</p>
    <p id="lastScore" style="display:none"></p>
    <button id="startBtn" disabled>Start Game</button>
  </div>

  <canvas id="gameCanvas"></canvas>

  <script>
    // ===== Canvas & DPR =====
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d", { alpha: false });
    let DPR = Math.max(1, window.devicePixelRatio || 1);

    function resizeCanvas() {
      DPR = Math.max(1, window.devicePixelRatio || 1);
      const cssW = window.innerWidth;
      const cssH = window.innerHeight;
      canvas.style.width = cssW + "px";
      canvas.style.height = cssH + "px";
      canvas.width = Math.floor(cssW * DPR);
      canvas.height = Math.floor(cssH * DPR);
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.scale(DPR, DPR);
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    // ===== State =====
    let gameRunning = false;
    let score = 0;

    // ===== Stars (parallax) =====
    const STAR_LAYERS = [
      { count: 32, speed: 0.6, size: [1, 2] },
      { count: 28, speed: 1.0, size: [1, 2.2] },
      { count: 20, speed: 1.6, size: [1.2, 2.6] },
    ];
    let stars = [];
    function initStars() {
      stars = [];
      const w = window.innerWidth, h = window.innerHeight;
      for (const layer of STAR_LAYERS) {
        for (let i = 0; i < layer.count; i++) {
          stars.push({
            x: Math.random() * w,
            y: Math.random() * h,
            r: layer.size[0] + Math.random() * (layer.size[1]-layer.size[0]),
            speed: layer.speed
          });
        }
      }
    }
    initStars();
    function updateStars() {
      const h = window.innerHeight, w = window.innerWidth;
      for (const s of stars) {
        s.y += s.speed;
        if (s.y > h) { s.y = -4; s.x = Math.random() * w; }
      }
    }
    function drawStars() {
      ctx.fillStyle = "#fff";
      for (const s of stars) {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // ===== Assets =====
    const rocketImg = new Image();   rocketImg.src   = "assets/rocket.gif";
    const obstacleImg = new Image(); obstacleImg.src = "assets/obstacle.gif";
    const coinImg = new Image();     coinImg.src     = "assets/coin.png";

    let assetsLoaded = 0;
    const totalAssets = 3;
    const startBtn = document.getElementById("startBtn");
    const home = document.getElementById("homeScreen");
    const lastScoreEl = document.getElementById("lastScore");

    function onAssetLoaded(){ if(++assetsLoaded === totalAssets){ startBtn.disabled = false; } }
    rocketImg.onload = onAssetLoaded;
    obstacleImg.onload = onAssetLoaded;
    coinImg.onload = onAssetLoaded;

    // --- Fallback: 1 —Å–µ–∫—É–Ω–¥—ã–Ω –¥–∞—Ä–∞–∞ —è–º–∞—Ä —á –±–∞–π—Å–∞–Ω Start –∏–¥—ç–≤—Ö–∂“Ø“Ø–ª–Ω—ç ---
    setTimeout(()=>{ startBtn.disabled = false; }, 1000);

    // ===== Game objects =====
    const R_INIT_W = 50, R_INIT_H = 50;
    let rocket = { x: 0, y: 0, w: R_INIT_W, h: R_INIT_H };
    let obstacles = [];
    let coins = [];
    let lastObstacleSpawn = 0;
    let lastCoinSpawn = 0;

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    // ===== Swipe/drag control (X-axis only) =====
    let dragging = false;
    let dragOffsetX = 0;

    canvas.addEventListener("touchstart", (e) => {
      if (!gameRunning) return;               // —Ç–æ–≥–ª–æ–æ–º —ç—Ö–ª—ç—ç–≥“Ø–π “Ø–µ–¥ event –∞–≤–∞—Ö–≥“Ø–π
      const t = e.changedTouches[0];
      dragging = true;
      dragOffsetX = t.clientX - rocket.x;
      e.preventDefault();
    }, { passive: false });

    canvas.addEventListener("touchmove", (e) => {
      if (!dragging || !gameRunning) return;
      const t = e.changedTouches[0];
      const mx = t.clientX;
      rocket.x = clamp(mx - dragOffsetX, 0, window.innerWidth - rocket.w);
      e.preventDefault();
    }, { passive: false });

    canvas.addEventListener("touchend", () => { dragging = false; });

    // Keyboard (desktop test)
    document.addEventListener("keydown", (e) => {
      if (!gameRunning) return;
      if (e.code === "ArrowLeft")  rocket.x = clamp(rocket.x - 24, 0, window.innerWidth - rocket.w);
      if (e.code === "ArrowRight") rocket.x = clamp(rocket.x + 24, 0, window.innerWidth - rocket.w);
    });

    // ===== Home / Start =====
    startBtn.addEventListener("click", () => {
      // –∑–∞—Ä–∏–º —Ç”©—Ö”©”©—Ä”©–º–∂ –¥—ç—ç—Ä layout ”©”©—Ä—á–ª”©–≥–¥–¥”©–≥ —Ç—É–ª canvas-–≥ –¥–∞—Ö–∏–Ω —Ç–æ—Ö–∏—Ä—É—É–ª—ä—è
      resizeCanvas();
      startGame();
      home.style.display = "none";
    });

    function startGame() {
      gameRunning = true;
      score = 0;
      obstacles = [];
      coins = [];
      initStars();
      rocket.w = R_INIT_W; rocket.h = R_INIT_H;
      rocket.x = (window.innerWidth - rocket.w) / 2;
      rocket.y = window.innerHeight - (rocket.h + 80);
      lastObstacleSpawn = performance.now();
      lastCoinSpawn = performance.now();
      requestAnimationFrame(gameLoop);
    }

    // ===== Spawners =====
    function spawnObstacle(time) {
      if (time - lastObstacleSpawn > 1500) {
        const size = 36;
        const x = Math.random() * (window.innerWidth - size);
        obstacles.push({ x, y: -size, w: size, h: size, vy: 3 });
        lastObstacleSpawn = time;
      }
    }
    function spawnCoin(time) {
      if (time - lastCoinSpawn > 1000) {
        const size = 22;
        const x = Math.random() * (window.innerWidth - size);
        coins.push({ x, y: -size, w: size, h: size, vy: 2 });
        lastCoinSpawn = time;
      }
    }

    // ===== Loop =====
    function gameLoop(time) {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      updateStars();
      drawStars();

      spawnObstacle(time);
      spawnCoin(time);

      // GIF-“Ø“Ø–¥–∏–π–≥ –∑”©–≤—Ö”©–Ω –∞—á–∞–∞–ª—Å–∞–Ω “Ø–µ–¥ –Ω—å –∑—É—Ä–Ω–∞ (–∞–ª–¥–∞–∞/–≥–∞—Ü–∞–ª—Ç—ç—ç—Å —Å—ç—Ä–≥–∏–π–ª–Ω—ç)
      if (rocketImg.complete)   ctx.drawImage(rocketImg,   rocket.x, rocket.y, rocket.w, rocket.h);

      for (const o of obstacles) {
        o.y += o.vy;
        if (obstacleImg.complete) ctx.drawImage(obstacleImg, o.x, o.y, o.w, o.h);
      }

      for (const c of coins) {
        c.y += c.vy;
        if (coinImg.complete) ctx.drawImage(coinImg, c.x, c.y, c.w, c.h);
      }

      // Collisions
      for (const o of obstacles) {
        if (collide(rocket, o)) {
          gameRunning = false;
          lastScoreEl.style.display = "block";
          lastScoreEl.textContent = "–¢–∞–Ω—ã –æ–Ω–æ–æ: " + score;
          home.style.display = "flex";
          return;
        }
      }
      for (let i = coins.length - 1; i >= 0; i--) {
        if (collide(rocket, coins[i])) {
          score++;
          coins.splice(i, 1);
        }
      }

      // Cleanup
      const H = window.innerHeight;
      obstacles = obstacles.filter(o => o.y < H + 60);
      coins     = coins.filter(c => c.y < H + 60);

      // HUD
      ctx.font = `${Math.max(14, window.innerWidth / 20)}px Arial`;
      ctx.fillStyle = "#fff";
      ctx.fillText("–û–Ω–æ–æ: " + score, 10, 30);

      requestAnimationFrame(gameLoop);
    }

    function collide(a, b) {
      return a.x < b.x + b.w &&
             a.x + a.w > b.x &&
             a.y < b.y + b.h &&
             a.y + a.h > b.y;
    }
  </script>
</body>
</html>