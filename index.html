<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Space Rocket Game</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      font-family: sans-serif;
      color: white;
      text-align: center;
      touch-action: none; /* Prevent default touch behaviors */
    }
    #gameCanvas {
      display: block;
      width: 100%;
      height: 100vh;
      background: black;
    }
    #homeScreen {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    #homeScreen h1 {
      font-size: 5vw;
      margin-bottom: 2vh;
    }
    #homeScreen p {
      font-size: 3vw;
      margin-bottom: 2vh;
    }
    #startBtn {
      padding: 2vh 4vw;
      font-size: 4vw;
      background: #ffcc00;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    #startBtn:hover {
      background: #ffdd33;
    }
  </style>
</head>
<body>
  <div id="homeScreen">
    <h1>üöÄ Space Rocket</h1>
    <p>–ü—É—É–∂–∏–Ω–≥–∞–∞ —É–¥–∏—Ä–¥–∞–∂ —Å–∞–∞–¥—É—É–¥—ã–≥ —Ç–æ–π—Ä—á, –∞–ª—å –±–æ–ª–æ—Ö –æ–ª–æ–Ω coin —Ü—É–≥–ª—É—É–ª!</p>
    <button id="startBtn" disabled>Start Game</button>
  </div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Responsive canvas sizing
    function resizeCanvas() {
      canvas.width = window.innerWidth * window.devicePixelRatio;
      canvas.height = window.innerHeight * window.devicePixelRatio;
      ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    let gameRunning = false;

    // Background stars
    const stars = Array.from({ length: 100 }, () => ({
      x: Math.random() * window.innerWidth,
      y: Math.random() * window.innerHeight,
      size: Math.random() * 2,
      speed: 0.5 + Math.random() * 1.5
    }));

    // Assets
    const rocketImg = new Image();
    rocketImg.src = "assets/rocket.png"; // GIF-–∏–π–Ω –æ—Ä–æ–Ω–¥ PNG –∞—à–∏–≥–ª–∞–∂ –±–∞–π–Ω–∞
    const obstacleImg = new Image();
    obstacleImg.src = "assets/obstacle.png"; // GIF-–∏–π–Ω –æ—Ä–æ–Ω–¥ PNG –∞—à–∏–≥–ª–∞–∂ –±–∞–π–Ω–∞
    const coinImg = new Image();
    coinImg.src = "assets/coin.png";

    // Preload assets
    let assetsLoaded = 0;
    const totalAssets = 3;
    function assetLoaded() {
      assetsLoaded++;
      if (assetsLoaded === totalAssets) {
        document.getElementById("startBtn").disabled = false;
      }
    }
    rocketImg.onload = assetLoaded;
    obstacleImg.onload = assetLoaded;
    coinImg.onload = assetLoaded;

    // Game objects
    let rocket = { x: window.innerWidth / 2 - 25, y: window.innerHeight - 100, width: 50, height: 50, dx: 0, dy: 0 };
    let obstacles = [];
    let coins = [];
    let score = 0;
    let lastObstacleSpawn = 0;
    let lastCoinSpawn = 0;

    // Touch controls
    let touchStartX = 0;
    let touchStartY = 0;
    canvas.addEventListener("touchstart", e => {
      e.preventDefault();
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    });
    canvas.addEventListener("touchmove", e => {
      e.preventDefault();
      const touchX = e.touches[0].clientX;
      const touchY = e.touches[0].clientY;
      const deltaX = touchX - touchStartX;
      const deltaY = touchY - touchStartY;
      rocket.dx = deltaX * 0.05; // Adjust sensitivity
      rocket.dy = deltaY * 0.05;
      touchStartX = touchX;
      touchStartY = touchY;
    });
    canvas.addEventListener("touchend", () => {
      rocket.dx = 0;
      rocket.dy = 0;
    });

    document.getElementById("startBtn").addEventListener("click", () => {
      document.getElementById("homeScreen").style.display = "none";
      startGame();
    });

    // Keyboard controls (for testing on desktop)
    document.addEventListener("keydown", e => {
      if (e.code === "ArrowLeft") rocket.dx = -5;
      if (e.code === "ArrowRight") rocket.dx = 5;
      if (e.code === "ArrowUp") rocket.dy = -5;
      if (e.code === "ArrowDown") rocket.dy = 5;
    });
    document.addEventListener("keyup", () => {
      rocket.dx = 0;
      rocket.dy = 0;
    });

    function startGame() {
      gameRunning = true;
      score = 0;
      rocket.x = window.innerWidth / 2 - 25;
      rocket.y = window.innerHeight - 100;
      rocket.dx = 0;
      rocket.dy = 0;
      obstacles = [];
      coins = [];
      lastObstacleSpawn = performance.now();
      lastCoinSpawn = performance.now();
      requestAnimationFrame(gameLoop);
    }

    function spawnObstacle(time) {
      if (time - lastObstacleSpawn > 1500) {
        const x = Math.random() * (window.innerWidth - 40);
        obstacles.push({ x, y: -50, width: 40, height: 40 });
        lastObstacleSpawn = time;
      }
    }

    function spawnCoin(time) {
      if (time - lastCoinSpawn > 1000) {
        const x = Math.random() * (window.innerWidth - 20);
        coins.push({ x, y: -20, width: 20, height: 20 });
        lastCoinSpawn = time;
      }
    }

    function updateStars() {
      for (let s of stars) {
        s.y += s.speed;
        if (s.y > window.innerHeight) {
          s.y = 0;
          s.x = Math.random() * window.innerWidth;
        }
      }
    }

    function drawStars() {
      ctx.fillStyle = "white";
      for (let s of stars) {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function gameLoop(time) {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Update rocket position
      rocket.x += rocket.dx;
      rocket.y += rocket.dy;
      // Keep rocket in bounds
      rocket.x = Math.max(0, Math.min(rocket.x, window.innerWidth - rocket.width));
      rocket.y = Math.max(0, Math.min(rocket.y, window.innerHeight - rocket.height));

      // Stars background
      updateStars();
      drawStars();

      // Draw rocket
      ctx.drawImage(rocketImg, rocket.x, rocket.y, rocket.width, rocket.height);

      // Spawn objects
      spawnObstacle(time);
      spawnCoin(time);

      // Update and draw obstacles
      for (let o of obstacles) {
        o.y += 3;
        ctx.drawImage(obstacleImg, o.x, o.y, o.width, o.height);
      }

      // Update and draw coins
      for (let c of coins) {
        c.y += 2;
        ctx.drawImage(coinImg, c.x, c.y, c.width, c.height);
      }

      // Collision detection
      for (let o of obstacles) {
        if (checkCollision(rocket, o)) {
          gameRunning = false;
          document.getElementById("homeScreen").style.display = "flex";
          document.querySelector("#homeScreen p").innerText = `–¢–∞–Ω—ã –æ–Ω–æ–æ: ${score}`;
        }
      }

      for (let i = coins.length - 1; i >= 0; i--) {
        if (checkCollision(rocket, coins[i])) {
          score++;
          coins.splice(i, 1);
        }
      }

      // Remove off-screen
      obstacles = obstacles.filter(o => o.y < window.innerHeight);
      coins = coins.filter(c => c.y < window.innerHeight);

      // Score
      ctx.font = `${Math.max(3, window.innerWidth / 20)}px Arial`;
      ctx.fillStyle = "white";
      ctx.fillText("–û–Ω–æ–æ: " + score, 10, 30);

      requestAnimationFrame(gameLoop);
    }

    function checkCollision(a, b) {
      return a.x < b.x + b.width &&
             a.x + a.width > b.x &&
             a.y < b.y + b.height &&
             a.y + a.height > b.y;
    }

    // Service Worker registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js');
      });
    }
  </script>
</body>
</html>